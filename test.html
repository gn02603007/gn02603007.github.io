<html>
<head>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<title>Test</title>
</head>
<script>
$( document ).ready(function() {
	$.ajax({
	    url: "https://api.nlsc.gov.tw/other/ListCounty",
	    beforeSend:function() {
	    },
	    success:function(result, status, xhr) {
	        try {
	            $(result).children().children().each(function(){
	                if (countyOrTownInList($(this).children("countyname").text())) {
	                    $("div.segment").append("<label><input class='county' type='checkbox' name='' value='"+$(this).children("countycode").text()+"' checked>"+$(this).children("countyname").text()+"</label><div class='town "+$(this).children("countycode").text()+"'>");
	                } else {
	                    $("div.segment").append("<label><input class='county' type='checkbox' name='' value='"+$(this).children("countycode").text()+"'>"+$(this).children("countyname").text()+"</label><div class='town "+$(this).children("countycode").text()+"'>");
	                }
	            });
	        } catch (e) {
	        }
	    },
	    error:function(xhr, status, error) {
	    },
	    complete:function(xhr, status) {
	    }
	});
	
	$(document).on("change", ".county", function () {
	    var townCode = $(this).val();
	    var townName = $(this).parent().text();
	    if ($(this).prop("checked")) {
	        $.ajax({
	            url: "https://api.nlsc.gov.tw/other/ListTown/" + townCode,
	            beforeSend:function() {
	            },
	            success:function(result, status, xhr) {
	                try {
	                    $(result).children().children().each(function(){
	                        $(".town." + townCode).append("<label><input class='' type='checkbox' name='segment' value='" + townName + ":" + $(this).children("townname").text()+"'>"+$(this).children("townname").text()+"</label> ");
	                    });
	                } catch (e) {
	                }
	            },
	            error:function(xhr, status, error) {
	            },
	            complete:function(xhr, status) {
	            }
	        });
	    } else {
	        $(".town." + townCode).empty();
	    }
	});
});
</script>
<body>
<div class="segment"></div>
</body>
</html>